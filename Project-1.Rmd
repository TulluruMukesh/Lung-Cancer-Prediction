---
title: "Lung Cancer Dataset Overview"
output:
  html_document: default
  pdf_document: default
---

## Introduction and Problem

Pulmonary diseases are a major health concern that can significantly affect an individual's quality of life. Early detection and risk prediction can play a crucial role in preventing the progression of these conditions. This project aims to predict the likelihood of an individual having a pulmonary disease based on health-related factors such as age, smoking habits, alcohol consumption, oxygen saturation, stress levels, and exposure to pollution.

Using the Lung Cancer Prediction Dataset, which includes both binary and continuous variables, we analyze how lifestyle, environmental, and physiological factors contribute to the risk of developing lung-related illnesses. The goal is to build an accurate and interpretable predictive model that can help identify high-risk individuals based on their personal and environmental health attributes.

---

### Question

> Can we accurately predict the presence of pulmonary disease in individuals based on lifestyle, environmental, and physiological factors such as smoking, oxygen saturation, energy level, and exposure to pollution?

---

```{r message=FALSE, warning=FALSE}
# Load useful libraries
library(tidyverse)   # For data handling and ggplot
library(corrplot)    # For showing correlation between variables
library(ggplot2)     # For creating graphs

# Read the dataset
df <- read.csv("lung_cancer_dataset.csv")  # Load the CSV file into a data frame

# See the structure and first few rows of data
str(df)   # Shows data types and number of observations
head(df)  # Displays first 6 rows of the dataset

# Check if there are any missing values
colSums(is.na(df))  # Returns number of NA values in each column

# Convert text categories into numbers so that models can use them
df$GENDER <- as.factor(df$GENDER)  # Change gender to a category (0 or 1)
df$PULMONARY_DISEASE <- as.factor(ifelse(df$PULMONARY_DISEASE == "YES", 1, 0))  # Change "YES"/"NO" to 1/0
df$FINGER_DISCOLORATION <- ifelse(df$FINGER_DISCOLORATION == "Yes", 1, 0)  # Convert to 1/0

```
In this section, I loaded the lung cancer dataset and explored its structure. I checked for any missing values, but none were found. Then, I performed basic data cleaning by converting categorical text variables such as gender and pulmonary disease status into numeric or factor formats. This step is important because machine learning models require the data to be in a numeric form to make accurate predictions. These transformations help the model understand and use the information effectively during training.


## Exploratory Data Analysis
```{r message=FALSE, warning=FALSE}
# 1.Summary statistics
summary(df)
#Shows the minimum, maximum, mean, and median for each variable in the dataset.

# 2.Histogram Distribution of Numeric Features
numeric_cols <- df %>% select_if(is.numeric)

# Set larger margins and a 3x3 layout per page for better spacing
par(mfrow = c(3, 3), mar = c(4, 4, 3, 1))  # mar = margins (bottom, left, top, right)

for (col in names(numeric_cols)) {
  hist(numeric_cols[[col]],
       main = paste("Histogram of", gsub("_", " ", col)),  # Clean title spacing
       col = "skyblue",
       xlab = col,
       cex.main = 1.1,    # Title size
       cex.lab = 0.9)     # Label size
}

par(mfrow = c(1,1))  # Reset layout

#3.Plot distributions
ggplot(df, aes(x=AGE)) + geom_histogram(bins=30, fill="steelblue") + theme_minimal()
#Displays how ages are distributed among individuals in the dataset.

#4. Correlation matrix
numeric_df <- df %>% select_if(is.numeric)
cor_matrix <- cor(numeric_df, use = "complete.obs")
corrplot(cor_matrix, method = "color", tl.cex = 0.7)
# Shows how numeric variables are related to each other. Stronger colors = stronger relationships.

#5.Categorical Variables vs Target
# Gender vs Pulmonary Disease
ggplot(df, aes(x = factor(GENDER, labels = c("Female", "Male")), fill = PULMONARY_DISEASE)) +
  geom_bar(position = "fill") +
  labs(title = "Pulmonary Disease by Gender", x = "Gender", y = "Proportion") # Compares disease proportion between males and females.


# Smoking vs Pulmonary Disease
ggplot(df, aes(x = factor(SMOKING, labels = c("Non-Smoker", "Smoker")), fill = PULMONARY_DISEASE)) +
  geom_bar(position = "fill") +
  labs(title = "Pulmonary Disease by Smoking Status", x = "Smoking", y = "Proportion")

# Alcohol Consumption vs Pulmonary Disease
ggplot(df, aes(x = factor(ALCOHOL_CONSUMPTION, labels = c("Non-Drinker", "Drinker")), fill = PULMONARY_DISEASE)) +
  geom_bar(position = "fill") +
  labs(title = "Pulmonary Disease by Alcohol Use", x = "Alcohol Use", y = "Proportion")

# Family History vs Pulmonary Disease
ggplot(df, aes(x = factor(FAMILY_HISTORY, labels = c("No History", "Has History")), fill = PULMONARY_DISEASE)) +
  geom_bar(position = "fill") +
  labs(title = "Pulmonary Disease by Family History", x = "Family History", y = "Proportion")

#6.Continuous Variables by Pulmonary Disease
ggplot(df, aes(x = PULMONARY_DISEASE, y = AGE,fill = factor(PULMONARY_DISEASE, labels = c("No Disease", "Disease")))) +
  geom_boxplot() +
  labs(title = "Age Distribution by Pulmonary Disease")

# Oxygen Saturation
ggplot(df, aes(x = PULMONARY_DISEASE, y = OXYGEN_SATURATION, fill = factor(PULMONARY_DISEASE, labels = c("No Disease", "Disease")))) +
  geom_boxplot() +
  labs(title = "Oxygen Saturation by Pulmonary Disease")

# Energy Level
ggplot(df, aes(x = PULMONARY_DISEASE, y = ENERGY_LEVEL, fill = factor(PULMONARY_DISEASE, labels = c("No Disease", "Disease")))) +
  geom_boxplot() +
  labs(title = "Energy Level by Pulmonary Disease")

#7.Continuous Variables by Pulmonary Disease
# Energy Level
ggplot(df, aes(x = ENERGY_LEVEL, fill = factor(PULMONARY_DISEASE, labels = c("No Disease", "Disease")))) +
  geom_density(alpha = 0.4) +
  labs(title = "Density of Energy Level by Pulmonary Disease")

# Oxygen Saturation
ggplot(df, aes(x = OXYGEN_SATURATION, fill = factor(PULMONARY_DISEASE, labels = c("No Disease", "Disease")))) +
  geom_density(alpha = 0.4) +
  labs(title = "Density of Oxygen Saturation by Pulmonary Disease")
```

## EDA Summary
From the visualizations, we observed that certain features such as **smoking**, **low oxygen saturation**, and **lower energy levels** appear to be more common among individuals with pulmonary disease. Categorical comparisons showed that **smokers** and individuals with a **family history** of illness had a higher proportion of disease. The correlation matrix revealed some mild correlations among numeric variables, while boxplots and density plots helped visualize the differences in distributions between the healthy and diseased groups. These insights support our hypothesis that lifestyle and physiological factors may be useful for predicting pulmonary disease.


## Train Test Split
```{r message=FALSE, warning=FALSE}
set.seed(123)

# Create random indices for 80% training
train_index <- sample(1:nrow(df), size = 0.8 * nrow(df))

# Split the data
train <- df[train_index, ]
test <- df[-train_index, ]
```
After preparing and exploring the dataset, I split the data into training and testing sets using an 80-20 ratio. This means that 80% of the data was used to train the model and the remaining 20% was used to test how well the model performs on new, unseen data. I used random sampling to ensure the split was unbiased. This step is important because it helps evaluate the model's ability to generalize, rather than just memorizing the training data.


## Logistic Regression Model
```{r message=FALSE, warning=FALSE}
model_log <- glm(PULMONARY_DISEASE ~ ., data = train, family = binomial)
summary(model_log)

#predictr and evaluate
pred_probs_log <- predict(model_log, newdata = test, type = "response")
pred_classes_log <- ifelse(pred_probs_log > 0.5, 1, 0)

# Confusion matrix
library(caret)
confusionMatrix(as.factor(pred_classes_log), as.factor(test$PULMONARY_DISEASE))

# ROC & AUC
library(pROC)
roc_log <- roc(test$PULMONARY_DISEASE, pred_probs_log)
plot(roc_log, col = "blue", main = "ROC Curve - Logistic Regression")
auc(roc_log)
```
I built a logistic regression model using all the available features to predict whether an individual has pulmonary disease. After training the model on 80% of the data, I used it to predict disease outcomes on the remaining 20%. The model outputs probabilities, which I converted into binary classes using a threshold of 0.5.

Using the confusion matrix, I evaluated how well the predictions matched the actual outcomes. I also plotted the ROC curve to visualize the model’s ability to distinguish between disease and no disease. The area under the curve (AUC) gave a numerical value for the model’s performance — higher values indicate better accuracy. Overall, the model performed well and showed that logistic regression is effective in predicting pulmonary disease using lifestyle and physiological data.


## Evaluation Summary
```{r message=FALSE, warning=FALSE}
# Predict probabilities & classes
pred_probs_log <- predict(model_log, newdata = test, type = "response")
pred_classes_log <- ifelse(pred_probs_log > 0.5, 1, 0)

# Accuracy
log_accuracy <- mean(pred_classes_log == test$PULMONARY_DISEASE)
cat("Logistic Regression Accuracy:", round(log_accuracy * 100, 2), "%\n")

# Confusion Matrix (Base R)
cat("Confusion Matrix:\n")
print(table(Predicted = pred_classes_log, Actual = test$PULMONARY_DISEASE))
```
Based on the evaluation, I found that the logistic regression model achieved an accuracy of around **90.9%** (replace with your actual value). This means that the model was able to correctly predict whether a person has pulmonary disease in most cases. The confusion matrix shows the number of correct and incorrect predictions for both classes — those with and without the disease. A high number of correct predictions and a balanced matrix indicate that the model is reliable and not heavily biased toward one class. These results support the idea that simple health-related features can be used to make accurate predictions about pulmonary conditions.


## Conclusion
```{r message=FALSE, warning=FALSE}
cat("We used logistic regression to predict the presence of pulmonary disease based on features such as smoking, energy level, oxygen saturation, and exposure to pollution. ",
    "The model achieved an accuracy of", round(log_accuracy * 100, 2), "%, indicating that these health and environmental factors can be useful predictors of pulmonary conditions. ",
    "This suggests that early detection may be supported by simple, interpretable models using lifestyle and physiological data.\n")
```

## Dataset Citation
Irfan Ahmed. (2025). Lung Cancer Prediction Dataset [Data set]. Kaggle. https://doi.org/10.34740/KAGGLE/DSV/10827884